---
export const prerender = false;
import Form from '../components/Form.astro';
import Welcome from '../components/Welcome.svelte';
import BaseLayout from '../layouts/BaseLayout.astro';
import { turso } from '../turso';

const { rows: posts } = await turso.execute('select * from posts');
---

<BaseLayout pageTitle="Homepage">
  <h2 class="text-2xl text-center my-4">Astro 5</h2>
  <Welcome />
  <Form />
  <h2 class="text-2xl text-center my-4 font-bold">Posts</h2>
  <div class="max-w-90 m-auto my-8">
    {
      posts.map((post: any) => {
        const createdAtStr = post.created_at.split(' ').join('T') + '.000Z';
        const createdAt = new Date(createdAtStr);
        const updatedAtStr = post.updated_at.split(' ').join('T') + '.000Z';
        const updatedAt = new Date(updatedAtStr);

        return (
          <div class="my-4">
            <p>Author: {post.author}</p>
            <p>Content: {post.body}</p>
            <p>
              Created at:{' '}
              {new Intl.DateTimeFormat('it-IT', {
               weekday: 'long',
                day:'2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Europe/Rome',
              }).format(createdAt)}
            </p>
            <p>
              Updated at:{' '}
              {new Intl.DateTimeFormat('it-IT', {
                weekday: 'long',
                day:'2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Europe/Rome',
              }).format(updatedAt)}
            </p>
          </div>
            <hr />
        );
      })
    }
  </div>
</BaseLayout>
